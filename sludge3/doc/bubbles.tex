\documentclass[aps]{revtex4}
\usepackage{graphicx}
\usepackage{amssymb,amsfonts,amsmath,amsthm}
\usepackage{chemarr}
\usepackage{bm}
\usepackage{pslatex}
\usepackage{mathptmx}
\usepackage{xfrac}

%% concentration notations
\newcommand{\mymat}[1]{\boldsymbol{#1}}
\newcommand{\mytrn}[1]{{#1}^{\mathsf{T}}}
\newcommand{\myvec}[1]{\overrightarrow{#1}}
\newcommand{\mygrad}{\vec{\nabla}}
\newcommand{\myhess}{\mathcal{H}}


\begin{document}
\title{Differential Bubbles}
\maketitle

\section{Differential Properties}

\subsection{Tangent Field}
Let us assume that we have three vectors $\vec{M}_-$, $\vec{M}_0$ and $\vec{M}_+$, with
$t_-=\left\vert \myvec{M_0M_-}\right\vert$ and $t_+=\left\vert \myvec{M_0M_+}\right\vert$.
The regular curve approximation is
\begin{equation}
	\vec{M}(t) = \vec{M}_0 + t \partial_t \vec{M} + \frac{1}{2} t^2 \partial_{t}^2 \vec{M}
\end{equation}
so that
\begin{equation}
\left\lbrace
\begin{array}{rcl}
	\myvec{M_0M_-} & = & -t_- \partial_t \vec{M} + \frac{1}{2} t_-^2 \partial_{t}^2 \vec{M}\\
	\myvec{M_0M_-} & = &  t_+ \partial_t \vec{M} + \frac{1}{2} t_+^2 \partial_{t}^2 \vec{M}.\\
\end{array}
\right.
\end{equation}
Setting

\begin{equation}
\left\lbrace
\begin{array}{rcl}
	\vec{V}_- & = & \frac{1}{t_-} \myvec{M_0M_-}\\
	\vec{V}_+ & = & \frac{1}{t_+} \myvec{M_0M_+}\\
\end{array}
\right.
\end{equation}
we shall solve
\begin{equation}
	\left\lbrace
	\begin{array}{rcl}
	\vec{V}_- & = & -\partial_t \vec{M} + \frac{1}{2} t_- \partial_{t}^2 \vec{M}\\
	\vec{V}_+ & = & \partial_t \vec{M} + \frac{1}{2} t_+ \partial_{t}^2 \vec{M}.\\
	\end{array}
\right.
\end{equation}

The first order approximation of the tangent field is
\begin{equation}
	\partial_t \vec{M} =  \frac{1}{t_-+t_+} \left(t_-\vec{V}_+ - t_+ \vec{V}_-\right)
\end{equation}

\subsection{Differential properties}
Let us assume that $\vec{M}(t)$ is a local parametric estimation of a contour.
Then the tangent vector around $\vec{M}_0$ is
\begin{equation}
	\partial_t \vec{M} = 
	 \frac{1}{t_-+t_+} \left\lbrack t_-\left(\frac{1}{t_+}\myvec{M_0M_+}\right) - t_+ \left(\frac{1}{t_-}\myvec{M_0M_-}\right)\right\rbrack
\end{equation}
and the tangent vector is
\begin{equation}
	\vec{\tau} = \frac{1}{\vert \partial_t \vec{M} \vert} \partial_t \vec{M}
\end{equation}
and the normal vector is
\begin{equation}
	\vec{n} = \begin{bmatrix}
		-\tau_y\\
		\tau_x\\
	\end{bmatrix}.
\end{equation}
If $s$ were a curvilinear abscissa then we would have
\begin{equation}
	\partial_s \vec{\tau} = \kappa \vec{n}
\end{equation}
so that
\begin{equation}
	\kappa = \frac{1}{\vert\partial_t \vec{M}\vert} \vec{n}.\partial_t \vec{\tau}
\end{equation}
with
\begin{equation}
	\partial_t \vec{\tau} = \frac{1}{t_-+t_+}
	 \left\lbrack 
	 t_-\left(\frac{1}{t_+}\left(\vec{\tau}_+ - \vec{\tau}_0\right)\right) 
	- 
	t_+ \left(\frac{1}{t_-}\left(\vec{\tau}_- - \vec{\tau}_0\right)\right)
	\right\rbrack.
\end{equation}

So that the differential properties can be determined in two passes:
\begin{enumerate}
	\item Estimate $\partial_t \vec{M}$, deduce $\vec{\tau}$ and $\vec{n}$, and store $\vert\partial_t \vec{M}\vert$,
	\item then estimate $\partial_t \vec{\tau}$ and deduce $\kappa = \frac{1}{\vert\partial_t \vec{M}\vert} \vec{n}.\partial_t \vec{\tau}$.
\end{enumerate}

\section{Segmentation}
\subsection{Computing Junctions with a Grid}

To be sure that a vector between to consecutive tracers has only ONE intersection with an horizontal or a vertical
grid, we must ensure that this distance is less than $\lambda=\min(\delta x_i,\delta y_j)/2$.

\begin{center}
\includegraphics[scale=1]{grid.eps}
\end{center}

There is an intersection with an Horizontal axis if one of the point is Not in TOP and Not in BOTTOM and
\begin{itemize}
	\item the other point is in TOP or in BOTTOM
	\item or the other point is between two different horizontal axis (i.e. directly above or below).
\end{itemize}

There is an intersection with a Vertical axis if one of the point is Not in LEFT and Not in RIGHT and
\begin{itemize}
	\item the other point is in LEFT or in RIGHT
	\item or the other point is between to different vertical axis (i.e. directly at left or at right). 
\end{itemize}

\subsection{Segmentation by Ray Casting}
For non penetrating bubbles, the successive junctions pairs on any axis is the sequence of inside/outside positions.
When those junctions are within the grid (taking special care of sides), we mark the inner position with the owning bubble ID.

\section{Effective Pressure Field}
We need to estimate the pressure gradient and Laplacian around any bulk position,
using the \textbf{standard} discretizations.

\subsection{First Order}
\begin{enumerate}
\item
Let us assume that the points $x_{i-1}$ and $x_i$ are in the bulk, and that there is
an intersection with a bubble at $x_i+\phi$. 
At this intersection, there is a pressure $P_\phi = P_{bubble} - \gamma \kappa_\phi$.
The pressure gradient while \textbf{entering} the bubble can be estimated by
$$
	\sigma^E_i = \dfrac{P_\phi - P_{i-1}}{\delta_x+\phi}.
$$
We can define an \textbf{Order 1 Horizontal Entering Pressure} $P^{E_1}$ by
$$
	\sigma^E_i = \dfrac{P^{E_1}_{i+1}-P_{i-1}}{2\delta_x} 
$$
so that
$$
	P^{E_1}_{i+1} = P_{i-1} + 2\delta_x\sigma^E_i
$$
\item
Let us assume that  the points $x_{i}$ and $x_{i+1}$ are in the bulk, and that
theres is an intersection with a bubble at $x_i-\psi$.
At this intersection, there is a pressure $P_\psi=P_{bubble} - \gamma \kappa_\psi$.
The pressure gradient while \textbf{leaving} the bubble can be estimated by
$$
	\sigma^L_i = \dfrac{P_{i+1}-P_\psi}{\delta_x + \psi}.
$$
We can define an \textbf{Order 1 Horizontal Leaving Pressure} $P^{L_1}$ by
$$
	\sigma^L_i = \dfrac{P_{i+1}-P^{L_1}_{i-1}}{2\delta_x}
$$
so that 
$$
	P^{L_1}_{i-1} = P_{i+1} - 2\delta_x \sigma^L_i
$$
\item
Let us assume that the point $x_i$ is between two bubbles at $x_i+\phi$ and $x_i-\psi$.
We have
$$
	\sigma_i = \dfrac{P_\phi - P_\psi}{\psi+\phi}
$$
so that
$$
	P^{L_1}_{i-1} = \dfrac{2\delta_x}{\phi+\psi} P_\psi
$$
and
$$
	P^{E_1}_{i+1} = \dfrac{2\delta_x}{\phi+\psi} P_\phi
$$
\end{enumerate}

By setting those fields initially to the original pressure and modifying them in case of bubble detection,
we can always compute, in the bulk
$$
	\partial_x P_i = \dfrac{P^{E_1}_{i+1} - P^{L_1}_{i-1}}{2\delta_x}
$$

\subsection{Second order}
With the respective assumptions of the previous paragraphâ€¦.
\begin{enumerate}

\item Since we assume that the slope at point $x_i$ is $\sigma_i^E$, the pressure expansion around $x_i$ 
is
$$
	P(x) = P_i + \sigma_i^E \left(x-x_i\right) + \frac{1}{2} K_i^E \left(x-x_i\right)^2.
$$
A good estimation of $K_i^E$, avoiding all singularities, is to use the least square solution,
leading to
$$
	K_i^E = \dfrac{2}{\delta_x^4+\phi^4}
	\left\lbrack
		\delta_x^2\left(P_{i-1}-P_{i} + \delta_x \sigma_i^E\right) + \phi^2\left(P_\phi - Pi - \phi\sigma_i^E\right)
	\right\rbrack
$$
We can define an \textbf{Order 2 Horizontal Entering Pressure} $P^{E_2}$ by
$$
	\partial_x^2 P_i = \dfrac{P_{i-1}-2P_i + P^{E_2}_{i+1}}{\delta_x^2} = K_i^E
$$
and
$$
	P^{E_2}_{i+1} = 2P_i - P_{i-1} + \delta_x^2 K_i^E
$$
\item
Since we assume that the slope at point $x_i$ is $\sigma_i^L$, the pressure expansion around $x_i$ 
is
$$
	P(x) = P_i + \sigma_i^L \left(x-x_i\right) + \frac{1}{2} K_i^L \left(x-x_i\right)^2.
$$
A good estimation of $K_i^E$, avoiding all singularities, is to use the least square solution,
leading to
$$
	K_i^L = 
$$

\item

\end{enumerate}

The same method can be applied near the wall for order 1 gradient estimation.\\
For one dimension, we need two auxiliary pressure fields when a bulk/bubble intersection is met.

\end{document}