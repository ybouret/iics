\documentclass[11pt]{amsart}
\usepackage{xcolor}
\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{a4paper}                   % ... or a4paper or a5paper or ... 
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{epstopdf}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}
\newcommand{\myvec}[1]{\overrightarrow{#1}}
\newcommand{\mygrad}{\vec{\nabla}}
\newcommand{\mymat}[1]{\mathbf{#1}}

\title{Technical Details}

\begin{document}
\maketitle


\section{Non uniform differential approximations}

Let $f(x)$ be a function estimated by
\[
	f(x) = f_0 + ax + b x^2
\]
with
\[
	f_\pm = f_0 \pm a \delta_\pm + b \delta_\pm^2
\]
and the conditions
\[
	\delta_\pm > 0 %,\; \delta_- + \delta_+ > 0.
\]
Then
\[
\begin{array}{rcl}
	a & = &
	\dfrac{1}{\delta_-^2\delta_+ + \delta_+^2\delta_-}
	\left[ 
	   \delta_-^2\left(f_+ - f_0 \right)
	 - \delta_+^2\left(f_- - f_0 \right)
	\right] \\
	\\
	& = & \dfrac{1}{\delta_- + \delta_+} 
	\left[
	 \dfrac{\delta_-}{\delta_+} \left(f_+ - f_0 \right)
	-\dfrac{\delta_+}{\delta_-} \left(f_- - f_0 \right)
	\right] \\
	\\
	& = & \dfrac{1}{\delta_- + \delta_+} 
	\left[
	\dfrac{\delta_-}{\delta_+} f_+
	+\left(\dfrac{\delta_+}{\delta_-} - \dfrac{\delta_-}{\delta_+}\right) f_0
	-\dfrac{\delta_+}{\delta_-} f_-
	\right]\\
\end{array}
\]
and
\[
\begin{array}{rcl}
	b & = & \dfrac{1}{\delta_-^2\delta_+ + \delta_+^2\delta_-}
	\left[ 
	\delta_- \left(f_+ - f_0\right) + \delta_+ \left(f_-f_0\right)
	\right]
\\
\end{array}
\]

\section{Geometrical Curvatures on an arc}
Let $A$ and $B$ be two points of an arc with their tangent unit vector $\vec{\tau}_A$
and $\vec{\tau}_B$ and their real curvatures $C_A$ and $C_B$, producing
some normal gradients $g_A$ and $g_B$.Let $Q$ be a point of that arc: 
how can we evaluate $g_Q$ ?\\
Let us introduce the first order position of $Q$ on the arc
\[
	\mu = \dfrac{\myvec{AQ}\myvec{AB}}{|AB|^2}.
\]
The first order gradient is
\[
	\tilde{g}_Q = g_A + \mu (g_B-g_A).
\]
The geometrical curvature of $Q$ is
\[
	\hat{C}_Q = \dfrac{2}{|AB|} \dfrac{\det(\myvec{AQ},\myvec{QB})}{|AQ||QB|}
\]
with the limiting cases
\[
	\begin{array}{rcl}
	\hat{C}_A & = & \dfrac{2}{|AB|^2}\det(\vec{\tau}_A,\myvec{AB}) \\
	\hat{C}_B & = & \dfrac{2}{|AB|^2}\det(\myvec{AB},\vec{\tau}_B). \\
	\end{array}
\]


\section{Gradient propagation}
Let's assume we know the gradient pressure at point $A$ and $B$, and
the tangential gradient pressure at point $Q$.
We also know the tangential and normal vectors at this three points
Let us assume that
\[
	\mygrad P = \alpha \vec{\tau} + \beta \vec{n}
\]
Then on $\myvec{AQ}$
\[
	\begin{array}{rcl}
		\alpha(\mu) & = & \alpha_A + \mu X_1 + \mu^2 X_2\\
		\beta(\mu)  & = & \beta_A  + \mu X_3 + \mu^2 X_4 \\
		\theta(\mu) & = & \theta_A + \mu \delta \theta.\\
	\end{array}
\]
On $\myvec{QB}$
\[
	\begin{array}{rcl}
		\alpha'(\lambda) & = & \alpha_B + \lambda X_5 + \lambda^2 X_6\\
		\beta'(\lambda)  & = & \beta_B  + \lambda X_7 + \lambda^2 X_8 \\
		\theta'(\lambda) & = & \theta_B + \lambda \delta \theta'.\\
	\end{array}
\]
So we have
\[
	P_Q - P_A = \int_0^1 
	\left[ \alpha(\mu)\vec{\tau}(\mu) + \beta(\mu) \vec{n}(\mu)\right]\myvec{AQ} \; d\mu
\]
and
\[
	P_Q - P_B = \int_0^1 
	\left[ 
		\alpha'(\lambda)\vec{\tau}'(\lambda) + 
		\beta'(\lambda) \vec{n}'(\lambda)
	\right]
	\myvec{BQ} \; d\lambda.
\]
The supplementary continuity relations are
\[
	\begin{array}{rcl}
		X_1 + X_2 & = & \alpha_Q - \alpha_A\\
		X_5 + X_6 & = & \alpha_Q - \alpha_B\\
		\beta_A + X_4 + X_5 & = & \beta_B + X_7 + X_8\\
	\end{array}
\]
The right approximation is the one that minimizes the change in $\mygrad P$
which is equivalent to minimize
\[
	E(\vec{X}) = \dfrac{1}{2} \vec{X}\mymat{M}\vec{X}
\]
with
\[\mymat{M} =\begin{pmatrix}6 & 6 & 0 & 0 & 0 & 0 & 0 & 0\cr 6 & 8 & 0 & 0 & 0 & 0 & 0 & 0\cr 0 & 0 & 6 & 6 & 0 & 0 & 0 & 0\cr 0 & 0 & 6 & 8 & 0 & 0 & 0 & 0\cr 0 & 0 & 0 & 0 & 6 & 6 & 0 & 0\cr 0 & 0 & 0 & 0 & 6 & 8 & 0 & 0\cr 0 & 0 & 0 & 0 & 0 & 0 & 6 & 6\cr 0 & 0 & 0 & 0 & 0 & 0 & 6 & 8\end{pmatrix}.\]

We have the following constraints
\begin{itemize}
	\item
	\[
		\vec{K}_A\vec{X} - \left(\alpha_Q-\alpha_A\right) = 0
	\]
	with
	\[\vec{K}_A=\begin{pmatrix}1\cr 1\cr 0\cr 0\cr 0\cr 0\cr 0\cr 0\end{pmatrix}\]
	
	\item
	\[
		\vec{K}_B\vec{X} - \left(\alpha_Q-\alpha_B\right) = 0
	\]
	with
	\[\vec{K}_B=\begin{pmatrix}0\cr 0\cr 0\cr 0\cr 1\cr 1\cr 0\cr 0\end{pmatrix}\]
	
	\item
	\[
		\vec{K}_0\vec{X} - \left(\beta_B - \beta_A\right) = 0
	\]
	with
	\[\vec{K}_0=\begin{pmatrix}0\cr 0\cr 1\cr 1\cr 0\cr 0\cr -1\cr -1\end{pmatrix}\]
	
	\item
	\[
	\begin{array}{rcl}
		P_Q - P_A & = & \displaystyle\int_0^1 
	\left[ \alpha(\mu)\vec{\tau}(\mu) + \beta(\mu) \vec{n}(\mu)\right]\myvec{AQ} \; d\mu \\
	& = & \alpha_A I_0 + \beta_A J_0 + \vec{\Pi}_A \vec{X}\\
	\end{array}
	\]
	with
	\[
		\vec{\Pi}_A =
		\begin{pmatrix}
			I_1\cr
			I_2\cr
			J_1\cr
			J_2\cr
			0\cr
			0\cr
			0\cr
			0\cr
		\end{pmatrix}
	\]
	and
	\[
		\begin{array}{rcl}
		I_0 & = & \int_0^1 \vec{\tau}(\mu)\myvec{AQ}\;d\mu\\
		J_0 & = & \int_0^1 \vec{n}(\mu)\myvec{AQ}\;d\mu\\
		I_1 & = & \int_0^1 \mu\vec{\tau}(\mu)\myvec{AQ}\;d\mu\\
		J_1 & = & \int_0^1 \mu\vec{n}(\mu)\myvec{AQ}\;d\mu\\
		I_2 & = & \int_0^1 \mu^2\vec{\tau}(\mu)\myvec{AQ}\;d\mu\\
		J_2 & = & \int_0^1 \mu^2\vec{n}(\mu)\myvec{AQ}\;d\mu\\
		\end{array}
	\]
	
	\item
	Likewise,
	\[
		P_Q - P_B = \alpha_B I_0' + \beta_B J_0' + \vec{\Pi}_B \vec{X}
	\]
	with
	\[
	\vec{\Pi}_B =
		\begin{pmatrix}
			0\cr
			0\cr
			0\cr
			0\cr
			I_1'\cr
			I_2'\cr
			J_1'\cr
			J_2'\cr
		\end{pmatrix}
	\]
	and
	\[
		\begin{array}{rcl}
		I_0' & = & \int_0^1 \vec{\tau}'(\mu)\myvec{BQ}\;d\mu\\
		J_0' & = & \int_0^1 \vec{n}'(\mu)\myvec{BQ}\;d\mu\\
		I_1' & = & \int_0^1 \mu\vec{\tau}'(\mu)\myvec{BQ}\;d\mu\\
		J_1' & = & \int_0^1 \mu\vec{n}'(\mu)\myvec{BQ}\;d\mu\\
		I_2' & = & \int_0^1 \mu^2\vec{\tau}'(\mu)\myvec{BQ}\;d\mu\\
		J_2' & = & \int_0^1 \mu^2\vec{n}'(\mu)\myvec{BQ}\;d\mu\\
		\end{array}
	\]
\end{itemize}
We introduce the lagrangian
\[
	\begin{array}{rcl}
	L(\vec{X}) &=& E(\vec{X}) \\
	           & & - \lambda_A\left[ \vec{K}_A\vec{X}   - (\alpha_Q-\alpha_A)\right]\\
	           & & - \lambda_B\left[ \vec{K}_A\vec{X}   - (\alpha_Q-\alpha_A)\right]\\
	           & & - \lambda_0\left[ \vec{K}_0\vec{X}   - (\beta_B-\beta_A)\right]\\
	           & & - \Lambda_A\left[ \vec{\Pi}_A\vec{X} - \delta\tilde{P}_A\right]\\
	           & & - \Lambda_B\left[ \vec{\Pi}_B\vec{X} - \delta\tilde{P}_B\right]\\
	\end{array}
\]
which is to be minimized w.r.t $\vec{X}$, meaning
\[
	\mymat{M}\vec{X}  = 
	\lambda_A \vec{K}_A +
	\lambda_B \vec{K}_B +
	\lambda_0 \vec{K}_0 +
	\Lambda_A \vec{\Pi}_A +
	\Lambda_B \vec{\Pi}_B.
\]
With $\mymat{J}=\mymat{M}^{-1}$,
\[
	\vec{X} = \lambda_A \mymat{J}\vec{K}_A +
	\lambda_B \mymat{J}\vec{K}_B +
	\lambda_0 \mymat{J}\vec{K}_0 +
	\Lambda_A \mymat{J}\vec{\Pi}_A +
	\Lambda_B \mymat{J}\vec{\Pi}_B.
\]
we find
\[
	\begin{pmatrix}
		\vec{K}_A\mymat{J}\vec{K}_A&\vec{K}_A\mymat{J}\vec{K}_B&\vec{K}_A\mymat{J}\vec{K}_0&\vec{K}_A\mymat{J}\vec{\Pi}_A&\vec{K}_A\mymat{J}\vec{\Pi}_B\cr
		\vec{K}_B\mymat{J}\vec{K}_A&\vec{K}_B\mymat{J}\vec{K}_B&\vec{K}_B\mymat{J}\vec{K}_0&\vec{K}_B\mymat{J}\vec{\Pi}_A&\vec{K}_B\mymat{J}\vec{\Pi}_B\cr
		\vec{K}_0\mymat{J}\vec{K}_A&\vec{K}_0\mymat{J}\vec{K}_B&\vec{K}_0\mymat{J}\vec{K}_0&\vec{K}_0\mymat{J}\vec{\Pi}_A&\vec{K}_0\mymat{J}\vec{\Pi}_B\cr
		\vec{\Pi}_A\mymat{J}\vec{K}_A&\vec{\Pi}_A\mymat{J}\vec{K}_B&\vec{\Pi}_A\mymat{J}\vec{K}_0&\vec{\Pi}_A\mymat{J}\vec{\Pi}_A&\vec{\Pi}_A\mymat{J}\vec{\Pi}_B\cr
		\vec{\Pi}_B\mymat{J}\vec{K}_A&\vec{\Pi}_B\mymat{J}\vec{K}_B&\vec{\Pi}_B\mymat{J}\vec{K}_0&\vec{\Pi}_B\mymat{J}\vec{\Pi}_A&\vec{\Pi}_B\mymat{J}\vec{\Pi}_B\cr
	\end{pmatrix}
	\begin{pmatrix}
	\lambda_A\cr
	\lambda_B\cr
	\lambda_0\cr
	\Lambda_A\cr
	\Lambda_B\cr
	\end{pmatrix}
	=
	\begin{pmatrix}
		(\alpha_Q-\alpha_A)\cr
		(\alpha_Q-\alpha_B)\cr
	 	(\beta_B-\beta_A)\cr
	 	\delta\tilde{P}_A\cr
	 	\delta\tilde{P}_B\cr
	\end{pmatrix}.
\]
The 5x5 matrix is
\[ \mymat{H} = \dfrac{1}{6}
\begin{pmatrix}
1 & 0 & 0 & I_1 & 0\cr 
0 & 1 & 0 & 0 & I_1'\cr
0 & 0 & 2 & J_1 & -J_1'\cr
I_1 & 0 & J_1 &  \eta & 0\cr
0 & I_1' & -J_1' & 0 & \eta'
\end{pmatrix}
\]
with
\[
	\begin{array}{rclcl}
		\eta & = & 3\,{J_2}^{2}-6\,J_1\,J_2+4\,{J_1}^{2}+3\,{I_2}^{2}-6\,I_1\,I_2+4\,{I_1}^{2} & = & 
		{I_1}^2+3(I_1-I_2)^2 + {J_1}^2 + 3 (J_1-J_2)^2\\
		\eta' & = & 3\,{J_2'}^{2}-6\,J_1'\,J_2'+4\,{J_1'}^{2}+3\,{I_2'}^{2}-6\,I_1'\,I_2'+4\,{I_1'}^{2} & = & {I_1'}^2+3(I_1'-I_2')^2 + {J_1'}^2 + 3 (J_1'-J_2')^2\\
	\end{array}
\]
\section{Differential Arc}
Let $\vec{r}_0$ and $\vec{r}_1$ be two points of a curve
with some respective tangent vector $\vec{\tau}_0$ and $\vec{\tau}_1$, and their
respective curvature $C_0$ and $C_1$.

We assume that $\vec{r}(\mu)$ represent the arc between those two points:
\[
	\vec{r}(\mu) = \vec{r}_0 + \mu \vec{a} + \mu^2 \vec{b} + \mu^3 \vec{c}
\]
We obtain
\[
	\dot{\vec{r}}(\mu) = \vec{a} + 2 \mu \vec{b} + 3 \mu^2 \vec{c}
\]
and
\[
	\ddot{\vec{r}}(\mu) = 2\vec{b} + 6 \mu \vec{c}.
\]
The curvature is
\[
	C(\mu) = \dfrac{\det\left(\dot{\vec{r}},\ddot{\vec{r}}\right)}{\left|\dot{\vec{r}}\right|^3}
\]
so that
\[
	C(\mu) = \dfrac{2}{\left|\vec{a} + 2 \mu \vec{b} + 3 \mu^2 \vec{c}\right|^3}
	\left[
	\det\left(\vec{a},\vec{b}\right)
	+3\mu\det\left(\vec{a},\vec{c}\right)
	+3\mu^2\det\left(\vec{b},\vec{c}\right)
	\right].
\]
We need a third degree polynomial, otherwise we can only represent
the arcs with the same sign of curvature.
We must solve the following equations
\[
	\left\lbrace
	\begin{array}{rcl}
	\vec{\delta} & = & \vec{a} + \vec{b} + \vec{c}\\
	0 & = & \left|\vec{a}\right| - \vec{a}\vec{\tau}_0\\
	0 & = & \left|\vec{a}+2\vec{b}+3\vec{c}\right| - \left(\vec{a}+2\vec{b}+3\vec{c}\right)\vec{\tau}_1\\
	0 & = & \dfrac{C_0}{2} \left|\vec{a}\right|^3 - \det\left(\vec{a},\vec{b}\right)\\
	\\
	0 & = & \dfrac{C_1}{2} \left|\vec{a}+2\vec{b}+3\vec{c}\right|^3 
	- \left[\det\left(\vec{a},\vec{b}\right)+3\det\left(\vec{a},\vec{c}\right)+3\det\left(\vec{b},\vec{c}\right)\right]
	\end{array}
	\right.
\]
Using $\vec{c} = \vec{\delta} - \left(\vec{a}+\vec{b}\right)$, so that
$\vec{a}+2\vec{b}+3\vec{c}=3\vec{\delta}-(2\vec{a}+\vec{b})$
and normalizing the equations we obtain
\[
	\left\lbrace
	\begin{array}{rcl}
	0 & = &  1-\dfrac{\vec{a}\vec{\tau}_0}{\left|\vec{a}\right|}\\
	\\
	0 & = & 1 
	- \dfrac{\left( 3\vec{\delta}-(2\vec{a}+\vec{b})\right)\vec{\tau}_1}{\left|3\vec{\delta}-(2\vec{a}+\vec{b})\right|}
	\\
	\\
	0 & = & \delta\left( \dfrac{C_0}{2} -  \dfrac{\det\left(\vec{a},\vec{b}\right)}{\left|\vec{a}\right|^3 }\right)\\
	\\
	0 & = & \delta\left( \dfrac{C_1}{2}
	 - \dfrac{\left[
	 \det\left(\vec{a},\vec{b}\right) + 3\det\left(\vec{a},\vec{\delta}\right) + 3\det\left(\vec{b},\vec{\delta}\right)
	  \right]}{\left|3\vec{\delta}-(2\vec{a}+\vec{b})\right|^3}\right)\\
	\end{array}
	\right.
\]

\section{Bezier Curve}
Let $\vec{P}_0,\vec{P}_1,\vec{P}_2,\vec{P}_3$
be the four control points of a Bezier curve
\[
	P(t) = \sum_{i=0}^4 B_i(t) \vec{P}_i
\]
where the $B_i$ are the Bernstein polynomials
\[
	\begin{array}{rcl|rcl|rcl}
	B_0(t) & = & (1-t)^3  & \dot{B}_0(t) & = & -3(1-t)^2     & \ddot{B}_0(t) & = & 6(1-t)\\
 	B_1(t) & = & 3(1-t)^2t & \dot{B}_1(t) & = &  3(3t^2-4t+1) & \ddot{B}_1(t) & = & 6(3t-2)\\
	B_2(t) & = & 3(1-t)t^2 & \dot{B}_2(t) & = &  3(2t-3t^2)   & \ddot{B}_2(t) & = & 6(1-3t)\\
	B_3(t) & = & t^3      & \dot{B}_3(t) & = &  3t^2         & \ddot{B}_3(t) & = & 6t    \\
	\end{array} 
\]
With
\[
	\dot{P}(t) = \sum_{i=0}^4 B_i(t) \vec{P}_i
\]
we have
\[
\begin{array}{rcl}
	\dot{P}(0) & = & 3\vec{P}_1 - 3\vec{P}_0 \\
	\dot{P}(1) & = & 3\vec{P}_3 - 3\vec{P}_2 \\
\end{array}
\]
and
\[
	\begin{array}{rcl}
	\ddot{P}(0) & = & 6\vec{P}_0 - 12 \vec{P}_1 + 6\vec{P}_2\\
	\ddot{P}(1) & = & 6\vec{P}_1 - 12 \vec{P}_2 + 6\vec{P}_3\\
	\end{array}
\]
We have
\[
	C_0 = \dfrac{\det(\dot{P}(0),\ddot{P}(0))}{\left|\dot{P}(0)\right|^3} 
	= \dfrac{2}{3} \dfrac{\det(\vec{P}_1 - \vec{P}_0,\vec{P}_2 - \vec{P}_1)}{\left|\vec{P}_1 - \vec{P}_0\right|^3}
\]
and
\[
	C_1 = \dfrac{\det(\dot{P}(1),\ddot{P}(1))}{\left|\dot{P}(1)\right|^3} 
	= \dfrac{2}{3} \dfrac{\det(\vec{P}_3 - \vec{P}_2,\vec{P}_1 - \vec{P}_2)}{\left|\vec{P}_3 - \vec{P}_2\right|^3}
\]


\end{document}


